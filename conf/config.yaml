# conf/config.yaml
defaults:
  - _self_
  - experiment: gsm8k_self  # ğŸ”¥ åœ¨è¿™é‡Œä¸€é”®åˆ‡æ¢æ•°æ®é›†ï¼hmmtex math_self sciqa gsm8k_self
  - optimizer: prime        # ğŸ”¥ åœ¨è¿™é‡Œåˆ‡æ¢ä¼˜åŒ–ç­–ç•¥

timestamp: "${now:%Y%m%d_%H%M%S}"

# ================= è·¯å¾„é…ç½® =================
paths:
  root: "/root/workspace/jychen/ex"
  index: "${paths.root}/index"
  jsonl: "${paths.root}/outputs/jsonl"
  json: "${paths.root}/outputs/json"
  png: "${paths.root}/outputs/png"
  txt: "${paths.root}/outputs/txt"

  corpus_file: "${paths.jsonl}/${experiment.corpus}_corpus.jsonl"
  index_dir: "${paths.index}/${experiment.corpus}_bm25_index"
  optimized_memory: "${paths.jsonl}/${experiment.tag}_optimized_memory_topk.jsonl"
  index_optimized_dir: "${paths.index}/${experiment.tag}_bm25_index"
  # ä¸­é—´äº§ç‰©è·¯å¾„é…ç½®ä¿æŒä¸å˜...
  stats_file: "${paths.json}/${experiment.tag}_memory_stats.json"
  stats_optimized_file: "${paths.json}/${experiment.tag}_memory_optimized_stats.json"
  stats_after_file: "${paths.json}/${experiment.tag}_memory_after_stats.json"

  cluster_output: "${paths.jsonl}/${experiment.tag}_clustered_result.jsonl"
  cluster_summary: "${paths.jsonl}/${experiment.tag}_cluster_summary.jsonl"
  cluster_plot: "${paths.png}/${experiment.tag}_cluster_distribution.png"
  cluster_vis: "${paths.png}/${experiment.tag}_visualization.png"

  freq_file: "${paths.jsonl}/${experiment.tag}_memory_freq.jsonl"
  freq_after_file: "${paths.jsonl}/${experiment.tag}_memory_after_freq.jsonl"

  result_dir: "${paths.txt}"
  result_log_file: "${paths.txt}/${experiment.tag}_on_${experiment.corpus}_${model.source}_${parameters.mode}_${timestamp}.txt"
  vis_image_file: "${paths.png}/${experiment.tag}_on_${experiment.corpus}_dist_${timestamp}.png"
  rag_cache_dir: "${paths.root}/rag_result_cache"

  lowfreq_textgrad_log: "${paths.txt}/lowfreq_textgrad_optimization_log_${timestamp}.txt"
  highfreq_textgrad_log: "${paths.txt}/highfreq_textgrad_optimization_log_${timestamp}.txt"
# ================= æ•°å­¦å¸¸æ•° =================
parameters:
  is_first: True
  total_rounds: 5
  resume_path: null # "/root/workspace/jychen/ex/results/20260102_114644_hmmtex_Loop/round_9"
  start_index: 0
  debug_num: null  # è°ƒè¯•æ—¶è®¾å°ä¸€ç‚¹

  max_retries: 5

  split_corpus_for_val: True
  split_ratio: 0.9
  retrieval_topk: 50
  final_topk: 5
  mode: "rag" # å¯é€‰: baseline, rag, all
  bemr_lambda1: 1.0  # å†å²æ•ˆç”¨æƒé‡
  bemr_lambda2: 0.5  # æ¢ç´¢/ä¸ç¡®å®šæ€§æƒé‡ (è°ƒå¤§æ­¤å€¼å¯ä¿æŠ¤ä½é¢‘è®°å¿†)
# ================= æ¨¡å‹é…ç½® =================
model:
  source: "sglang" 
  optimize: "sglang"
  hf_name: "Qwen/Qwen3-4B-Instruct-2507"
  device: "cuda"
  batch_size: 64
  max_input_len: 8192
  max_new_tokens: 8192

  gemini_name: "gemini-2.5-flash"

  # sglang_api_url: "http://127.0.0.1:30000/v1"
  # sglang_model_name: "Qwen/Qwen3-4B-Instruct-2507"
  
  sglang_model_name: "Qwen/Qwen3-30B-A3B-Thinking-2507" 
  sglang_api_url: "http://127.0.0.1:30001/v1"

  embedding_name: "BAAI/bge-large-en-v1.5"


expert_model:
  source: "sglang"
  name: "Qwen/Qwen3-30B-A3B-Thinking-2507"
  sglang_api_url: "http://127.0.0.1:30001/v1"
  # sglang_api_url: "http://127.0.0.1:30000/v1"
  # name: "Qwen/Qwen3-4B-Instruct-2507"
  max_new_tokens: 8192

# ================= èšç±»é…ç½® (ç›¸å¯¹ç¨³å®š) =================
cluster:
  method: "agglomerative"
  distance_threshold: 1.0
  kmeans_n_clusters: 10
  vis_method: "tsne"
  enable_pca_preprocess: True
  pca_preprocess_dims: 50
  tsne_perplexity: 40