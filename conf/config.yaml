# conf/config.yaml
defaults:
  - _self_
  - experiment: hmmtex  # ğŸ”¥ åœ¨è¿™é‡Œä¸€é”®åˆ‡æ¢æ•°æ®é›†ï¼hmmtex math_to_hmmt math_self sciqa
  - optimizer: default        # ğŸ”¥ åœ¨è¿™é‡Œåˆ‡æ¢ä¼˜åŒ–ç­–ç•¥

timestamp: "${now:%Y%m%d_%H%M%S}"

# ================= è·¯å¾„é…ç½® =================
paths:
  root: "/root/workspace/jychen/ex"
  index: "${paths.root}/index"
  jsonl: "${paths.root}/outputs/jsonl"
  json: "${paths.root}/outputs/json"
  png: "${paths.root}/outputs/png"
  txt: "${paths.root}/outputs/txt"

  corpus_file: "${paths.jsonl}/${experiment.corpus}_corpus.jsonl"
  index_dir: "${paths.index}/${experiment.corpus}_bm25_index"
  optimized_memory: "${paths.jsonl}/${experiment.tag}_optimized_memory_topk.jsonl"
  index_optimized_dir: "${paths.jsonl}/${experiment.tag}_bm25_index"
  # ä¸­é—´äº§ç‰©è·¯å¾„é…ç½®ä¿æŒä¸å˜...
  stats_file: "${paths.json}/${experiment.tag}_memory_stats.json"
  stats_optimized_file: "${paths.json}/${experiment.tag}_memory_optimized_stats.json"
  stats_after_file: "${paths.json}/${experiment.tag}_memory_after_stats.json"

  cluster_output: "${paths.jsonl}/${experiment.tag}_clustered_result.jsonl"
  cluster_summary: "${paths.jsonl}/${experiment.tag}_cluster_summary.jsonl"
  cluster_plot: "${paths.png}/${experiment.tag}_cluster_distribution.png"
  cluster_vis: "${paths.png}/${experiment.tag}_visualization.png"

  freq_file: "${paths.jsonl}/${experiment.tag}_memory_freq.jsonl"
  freq_after_file: "${paths.jsonl}/${experiment.tag}_memory_after_freq.jsonl"

  result_dir: "${paths.txt}"
  result_log_file: "${paths.txt}/${experiment.tag}_on_{experiment.corpus}_{model.source}_{parameters.mode}_{timestamp}.txt"
  vis_image_file: "${paths.png}/${experiment.tag}_on_{experiment.corpus}_dist_{timestamp}.png"
  rag_cache_dir: "${paths.root}/rag_result_cache"

# ================= æ•°å­¦å¸¸æ•° =================
parameters:
  is_first: True
  total_rounds: 2
  start_index: 0
  debug_num: 5  # è°ƒè¯•æ—¶è®¾å°ä¸€ç‚¹
  split_corpus_for_val: True
  split_ratio: 0.9
  retrieval_topk: 40
  final_topk: 5
  mode: "all" # å¯é€‰: baseline, rag, all
  bemr_lambda1: 1.0  # å†å²æ•ˆç”¨æƒé‡
  bemr_lambda2: 0.5  # æ¢ç´¢/ä¸ç¡®å®šæ€§æƒé‡ (è°ƒå¤§æ­¤å€¼å¯ä¿æŠ¤ä½é¢‘è®°å¿†)
# ================= æ¨¡å‹é…ç½® =================
model:
  source: "sglang" 
  optimize: "sglang"
  hf_name: "Qwen/Qwen3-4B-Instruct-2507"
  device: "cuda"
  batch_size: 20
  max_input_len: 8192
  max_new_tokens: 2048

  gemini_name: "gemini-2.5-flash"

  sglang_api_url: "http://127.0.0.1:30000/v1"
  sglang_model_name: "Qwen/Qwen3-4B-Instruct-2507"
  
  # name: "Qwen/Qwen2.5-14B-Instruct" # ä¸“å®¶æœ€å¥½æ¯”å­¦ç”Ÿ (Qwen-4B) å¼ºï¼Œæ¯”å¦‚Qwen/Qwen2.5-14B-Instruct
  # sglang_api_url: "http://127.0.0.1:30001/v1"

  embedding_name: "BAAI/bge-large-en-v1.5"


expert_model:
  source: "sglang"
  name: "Qwen/Qwen2.5-14B-Instruct" # ä¸“å®¶æœ€å¥½æ¯”å­¦ç”Ÿ (Qwen-4B) å¼ºï¼Œæ¯”å¦‚Qwen/Qwen2.5-14B-Instruct
  sglang_api_url: "http://127.0.0.1:30001/v1"

# ================= èšç±»é…ç½® (ç›¸å¯¹ç¨³å®š) =================
cluster:
  method: "agglomerative"
  distance_threshold: 1.0
  kmeans_n_clusters: 10
  vis_method: "tsne"
  enable_pca_preprocess: True
  pca_preprocess_dims: 50
  tsne_perplexity: 40